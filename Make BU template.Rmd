---
title: "R Notebook"
output: html_notebook
---

Read in and clean up the data. We are using data on BU (Buruli Ulcer) cases in Benin. Consists of a lat-long dataset with population size and BU cases. 

This is our demonstration dataset. We used this dataset to generate the following information from Earth Engine

BU is an environmentally transmitted pathogen. Therefore, land use / land cover change may play a role in transmission. Therefore we have data on land cover type, ndvi and forest loss. We also have precipitation and temperature data. 

Here we need to import, clean up our dataset and prepare it for modelling

```{r}
library(tidyverse)

temp <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/Ann_Temp_Mean.csv")


fcover <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/FCover_2000.csv")

fgain <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/FGain_2000.csv")

floss <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/FLoss_2000.csv")

landcov <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/Landcover_4000.csv")

ndvi <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/NDVI_2.csv")

precip <- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/EEID_Data/Google_Earth_Engine_Outputs-EEID/Precip_Mean.csv")

bu<- read_csv("C:/Users/lucik/Google Drive/Post Doc/Workshops/EEID_SpatialStats/BU_data.csv")
```

Start with climate variables. Annual mean temp and precip are scaled. So need to combine by FID and then scale the rain / temperature

Add in mean and sd ndvi, forest loss, gain and percent cover in 2000 m buffer and finally landcover variables

```{r}
temp%>%mutate(MeanTemp = MeanTemp/10)%>%left_join(precip)%>%rename(Precip_mm = mean)%>%left_join(fcover)%>%left_join(floss)%>%left_join(fgain)%>%mutate(FLOSS_ha = FLOSS_m/10000, FGAIN_ha = FGAIN_m/10000)%>%select(-FLOSS_m, -FGAIN_m)->template


ndvi%>%mutate(date = substr(`system:index`, 1, 8))%>%mutate(date = as.Date(date, format = "%Y%m%d"), `system:index` =  as.integer(substr(`system:index`,10,14)))%>%group_by(`system:index`)%>%summarise(MeanNDVI = mean(NDVI), SdNDVI = sd(NDVI))%>%right_join(template)->template


landcov%>%replace(.,is.na(.),0)%>%mutate(Forest = `40` + `170`, Agric = `30`, ShrGra = `110` + `130` + `140`, Urb = `190`, Water = `210`)%>%select(`system:index`, Forest, Agric,ShrGra, Urb, Water)->landcov

landcov$TotPix<-rowSums(landcov[,2:6])

landcov[,2:6]<-lapply(landcov[,2:6], `/`, landcov$TotPix)

landcov[,2:6]<-round(landcov[,2:6],2)
landcov%>%select(-TotPix)%>%right_join(template)%>%select(FID, MeanTemp:FGAIN_ha, Forest:SdNDVI)%>%left_join(bu)%>%select(Lat:BU_TOT, everything())->template
```

template done, now write tocsv

```{r}
write.csv(template, "template_BU.csv")

```

